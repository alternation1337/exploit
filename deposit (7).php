<?php
require("header.php");


#create cookie containing the plans
$plansArray = array();
$adminWallets = array();

foreach($__plans as $p){
    $d = array(
        "name" => $p["name"],
        "min" => $p["min"],
        "max" => $p["max"]
    );
    array_push($plansArray, $d);
}


foreach($__adminWallet as $k => $a){
    if($k === "id"){
        continue;
    }else if($k === "userId"){
        continue;
    }else {
        $d = array(
            "name" => $k,
            "value" => $a
        );
        array_push($adminWallets, $d);
    }
}

error_log(json_encode($__adminWallet));

if(!sapp\Cookie::isCookie("aenoxo-plans") || !sapp\Cookie::isCookie("aenoxo-adminWallets")){
    $cookie->createCookie("aenoxo-plans", json_encode($plansArray));
    $cookie->createCookie("aenoxo-adminWallets", json_encode($adminWallets));
}

?>

<div class="main_container">
    <?php require("sidebar.php"); ?>
    <div class="main">
        <?php require("topbar.php"); ?>

        <?php require("depositModal.php"); ?>

        <div class="generic_component">
            <h2>Overview</h2>
            <div class="generic_component__content">
                <div class="container">
                    <div class="row">
                        <?php foreach($__depositData as $k => $d): ?>
                        <div class="col-lg-4 col-md-6 col-sm-12 mb-3">
                            <div class="container_card">
                                <div class="top">
                                    <span style="background-color: <?= $d["color"] ?>"><i class="<?= $d["icon"] ?>"></i></span>
                                    <div>
                                        <p><?= $d["title"] ?></p>
                                        <h5><?= "$".number_format((int)$d["amount"], 2, ".", ",") ?></h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <?php endforeach; ?>
                    </div>
                </div>
            </div>
        </div>

        <div class="generic_component">
            <h2 style="margin: 0px;margin-bottom:20px">Pricing</h2>
            <?php require("../plans.php"); ?>
        </div>

        <div class="generic_component">
            <h2>Currency Converter</h2>
            <em style="font-size:0.8rem;" class="text-danger"><i class="bi bi-info-circle"></i> Please, check the equivalent token conversion before making payment</em>
            <div class="container mt-3">
                
            <script src="https://widgets.coingecko.com/coingecko-coin-converter-widget.js"></script>
            <script type="text/javascript">
            </script>
            <coingecko-coin-converter-widget  coin-id="bitcoin" currency="usd" background-color="#606680" font-color="#4c4c4c" locale="en" id="widget"></coingecko-coin-converter-widget>
            <coingecko-coin-converter-widget  coin-id="ethereum" currency="usd" background-color="#606680" font-color="#4c4c4c" locale="en" id="widget"></coingecko-coin-converter-widget>
            </div>
        </div>


        <div class="generic_component content_container">
        <div class="row" style="width: 90%;margin: 10px auto;">
            <div class="col-xl-12 col-lg-12 col-md-12">
            <div style="width:100%;margin-top:40px">
            <h4 class="referral_header">Make a deposit</h4>
                <form class="w-100" id="depositForm" action="<?= $_SERVER["REQUEST_URI"] ?>" method="POST">

                    <div class="form_group">
                        <label>Preferred Plan <sup style="color:#FC0077">*</sup></label>
                        <select class="deposit_input" name="plan" style="padding:16px;">
                            <option value="">Choose Plan</option>
                            <?php foreach($__plans as $p): ?>
                                <?php  
                                $capP="";
                                for($i=0; $i < strlen($p["name"]); $i++){
                                    if($i === 0) $capP.=strtoupper($p["name"][$i]);
                                    else {
                                        $capP.=$p["name"][$i];
                                    }
                                }
                                ?>
                            <option value="<?= $p["name"] ?>">
                                <?= $capP ?>
                            </option>
                            <?php  endforeach ?>
                        </select>
                    </div>


                    <div class="form_group">
                    <label>Token <sup style="color:#FC0077">*</sup></label>
                        <select class="deposit_input" id="marker" name="token" style="padding:16px;">
                            <option value="">Choose Token **</option>
                            <?php foreach($__wallets as $w): ?>
                                <option value="<?= $w["value"] ?>">
                                    <?= $w["name"] ?>
                                </option>
                            <?php endforeach ?>
                        </select>
                        <em style="font-size:0.7rem;" id="caution" class="text-danger"><i class="bi bi-info-circle"></i>    Wallet address is on the ERC20 network (except Bitcoin)</em>
                        <div id="tokenAddress">
                            <span id="checkmark"><i class="fa fa-check" style="color:white;font-size:1.5rem"></i></span>
                        </div>
                    </div>



                    <div class="form_group">
                        <label>Amount <sup style="color:#FC0077">*</sup></label>
                        <input style="padding:10px" autocomplete="off" class="deposit_input" type="number" placeholder="Amount" name="amount" />
                    </div>

                    <div class="form_button">
                        <button class="fbtn" disabled>
                            Deposit
                        </button>
                    </div>
                </form>
            </div>

            <hr />

            <div style="width:100%;margin-top:40px">
            <div class="form-text" style="overflow-x:scroll">
                <h4 class="referral_header">All Deposits</h4>
                <div class="form-inner table-inner">
                <?php if(count($__deposits) > 0): ?>
                    <table>
                        <thead>
                        <tr style="text-transform:uppercase;letter-spacing:0.8px;font-size: 0.8rem">
                            <?php foreach($__transactionHeader as $h): ?>
                                <th><?= $h ?></th>
                            <?php endforeach ?>
                        </tr>
                        </thead>
                        <tbody>
                        
                        <?php foreach($__deposits as $r): ?>
                            <tr class="bg-<?= getStatusColor($r["status"]) ?>"  style="font-size: 0.7rem;letter-spacing:0.8px;color:#150550;padding:10px">
                                <td><?= $r["id"] ?></td>
                                <td><?= $r["type"] ?></td>
                                <td><?= $r["sender"] ?></td>
                                <td><?= $r["receiver"] ?></td>
                                <td><?= $r["token"] ?></td>
                                <td><?= $r["amount"] ?></td>
                                <td><?= $r["status"] ?></td>
                                <td><?= $r["createdAt"] ?></td>
                            </tr>
                        <?php endforeach ?>

                        </tbody>
                    </table>
                <?php else: ?>
                    <h5 class="text-danger" style="font-family:GT Walsheim Pro Regular Regular;letter-spacing: 0.4px;font-size:0.85rem">No Deposit(s) found</h5>
                <?php endif;  ?>
                </div>
            </div>
            </div>
    </div>
</div>








<?php
require("footer.php");

?>



<?php

if($_SERVER["REQUEST_METHOD"] === "POST"){

    $amount = $_POST["inputAmount"];
    $token = $_POST["inputToken"];
    $sender = trim($_POST["inputSender"]);
    $userId = $__userdata["userId"];
    $receiver = $__adminWallet[$token];
    $type="deposit";

    $user->submitTransaction($userId, $type,$sender, $receiver, $token, $amount);
}

?>